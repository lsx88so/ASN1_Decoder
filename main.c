#include <stdio.h>
#include <stdint.h>
#include "debug.h"
#include "asn1.h"
#include "apdu_types.h"
#include "cosem_association.h"

// static volatile cosem_asso_info_t asso_info = {0};

int main(){
    DEBUG_OK("ASN Decoder Test\n");
	uint8_t packet[] = {0x60, 0x1D, 0xA1 ,0x09 ,0x06 ,0x07 ,0x60 ,0x85 ,0x74 ,0x05 ,0x08 ,0x01 ,0x01 ,0xBE ,0x10 ,0x04 ,0x0E ,0x01 ,0x00 ,0x00 ,0x00 ,0x06 ,0x5F ,0x1F ,0x04 ,0x00 ,0x00 ,0x1E ,0x1D ,0xFF ,0xFF}; // AARQ
	// uint8_t packet[] = {0x61 ,0x29 ,0xA1 ,0x09 ,0x06 ,0x07 ,0x60 ,0x85 ,0x74 ,0x05 ,0x08 ,0x01 ,0x01 ,0xA2 ,0x03 ,0x02 ,0x01 ,0x00 ,0xA3 ,0x05 ,0xA1 ,0x03 ,0x02 ,0x01 ,0x00 ,0xBE ,0x10 ,0x04 ,0x0E ,0x08 ,0x00 ,0x06 ,0x5F ,0x1F ,0x04 ,0x00 ,0x00 ,0x1E ,0x1D ,0x04 ,0x00 ,0x00 ,0x07}; // AARE
	// Faltu uint8_t packet[] = {0xC3 ,0x01 ,0xC1 ,0x00 ,0x0F ,0x00 ,0x00 ,0x28 ,0x00 ,0x00 ,0xFF ,0x01 ,0x01 ,0x09 ,0x10 ,0xE2 ,0xCE ,0x65 ,0xED ,0x10 ,0x3D ,0xF1 ,0x37 ,0x5D ,0x46 ,0xF8 ,0xFF ,0x9B ,0x57 ,0x62 ,0xC8}; // AUTH
	// uint8_t packet[] = {0x81 ,0x80 ,0x14 ,0x05 ,0x02 ,0x01 ,0x00 ,0x06 ,0x02 ,0x01 ,0x00 ,0x07 ,0x04 ,0x00 ,0x00 ,0x00 ,0x01 ,0x08 ,0x04 ,0x00 ,0x00 ,0x00 ,0x01}; // UA
	uint32_t size = sizeof(packet);
	DEBUG_OK("Size of Raw Packet : %d", size);
	DEBUG_ARRAY("Raw Packet", packet, size, "%02X ");

	static tlv_triplet_t triplet = {0};
	uint8_t number_of_nodes = decode_asn_tree(&triplet, packet, size);
	DEBUG_OK("Total Number of Nodes : %d", number_of_nodes);
}